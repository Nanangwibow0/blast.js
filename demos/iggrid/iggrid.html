<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
		<link rel="stylesheet" href="http://cdn-na.infragistics.com/jquery/20132/latest/css/themes/infragistics/infragistics.theme.css">
		<link rel="stylesheet" href="http://cdn-na.infragistics.com/jquery/20132/latest/css/structure/infragistics.css">
		<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
		<script type="text/javascript" src="http://cdn-na.infragistics.com/jquery/20132/latest/js/infragistics.core.js"></script>
		<script type="text/javascript" src="http://cdn-na.infragistics.com/jquery/20132/latest/js/infragistics.lob.js"></script>
		<script type="text/javascript" src="../../blast.js"></script>
		<script src="data.min.js"></script>
		<style type="text/css">
			body {
				font-family: Verdana;
				font-size: 12;
			}
			h4 {
				color: blue;
			}
			h5 {
				color: gray;
			}
		</style>
		<script type="text/javascript">
			$(document).ready(function () {
				// observe the JSON data representing NorthWind Orders (Which is just a list of plain javascript objects)
				var dataModel = blast.observe(data.Northwind.Orders);

				// create a simple model to bind to a bunch of input fields
				// NOTICE how we are passing observables already generated by the above call to blast.observe() ! 
				var inputsModel = {
					OrderID: dataModel[0].OrderID,
					CustomerID: dataModel[0].CustomerID,
					ShipAddress: dataModel[0].ShipAddress
				};
				// bind it, so that any HTML elements marked with data-bind="something" will be bound in the current scope 
				blast.bind(inputsModel, {event: "keyup"});

				$("#status").text("Binding IgniteUI Grid to : "  + dataModel.length + " rows. Change any data cell through the Blast.JS API in the console and watch it update in REAL TIME in the grid.");

				var cols = [
					{key: "OrderID", headerText: "Order ID"},
					{key: "CustomerID", headerText: "Customer ID"},
					{key: "ShipAddress", headerText: "Ship Address"}
				];
				$("#grid1").igGrid({
					dataSource: blast.json(dataModel),
					height: 400,
					autoCommit: true,
					primaryKey: "OrderID",
					autoGenerateColumns: false,
					columns: cols,
					width: 600,
					features: [
						{
							name: "Updating",
							editMode: "cell",
							enableAddRow: false,
							enableDeleteRow: false,
						}
					]
				});
				// link rendered cells with observable
				var i = 0, j = 0;
				$("#grid1").find("tr[data-id] td").each(function () {
					blast.link(this, {key: cols[j].key, init: false, event: "DOMCharacterDataModified"}, dataModel[i]);
					if (j === cols.length - 1) {
						j = 0;
						i++;
					} else {
						j++;
					}
				});
			});
		</script>
	</head>
	<body>
		<span id="status"></span>
		<div>
			<hr/>
			<h4>First Row Data - change it & watch (bound to the same observable model that the igGrid is bound to)</h4>
			<h5> You can also update cells in the grid & watch it change in the bound input fields! <span style="color: green;">Since the Mutation Level 3 DOM Event  - DOMCharacterDataModified is used, this ensures that ANY code can change the grid cells contents, and Blast will figure it out and fire the subscribed handlers for those observables! </span></h5>
			<div>Order ID: <input data-bind="OrderID"/></div>
			<div>Customer ID: </span><input data-bind="CustomerID"/></div>
			<div>Ship Address:<input data-bind="ShipAddress"/></div>
			<hr/>
		</div>
		<table id="grid1"></table>
	</body>
</html>